{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { doc, updateDoc, deleteDoc, setDoc, getDoc } from 'firebase/firestore';\nimport { db } from '../config/firebase';\nconst useMatchManagement = () => {\n  _s();\n  const [selectedMatch, setSelectedMatch] = useState(null);\n  const [showScoreModal, setShowScoreModal] = useState(false);\n  const [matchToPlay, setMatchToPlay] = useState(null);\n  const [scoreEquipeInput, setScoreEquipeInput] = useState('');\n  const [scoreAdversaireInput, setScoreAdversaireInput] = useState('');\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\n  const [matchToReset, setMatchToReset] = useState(null);\n  const marquerCommeJoue = async (matchId, matchs) => {\n    const match = matchs.find(m => m.id === matchId);\n    if (!match) return;\n    setMatchToPlay(match);\n    setShowScoreModal(true);\n  };\n  const confirmerScoreEtJouer = async (matchs, setMatchs, showNotification) => {\n    if (!matchToPlay) return;\n    const scoreEquipe = parseInt(scoreEquipeInput) || 0;\n    const scoreAdversaire = parseInt(scoreAdversaireInput) || 0;\n    try {\n      const matchRef = doc(db, 'matchs', String(matchToPlay.id));\n      const matchDoc = await getDoc(matchRef);\n      if (matchDoc.exists()) {\n        await updateDoc(matchRef, {\n          statut: 'joue',\n          score_equipe: scoreEquipe,\n          score_adversaire: scoreAdversaire,\n          updatedAt: new Date()\n        });\n      } else {\n        const matchData = {\n          id: String(matchToPlay.id),\n          adversaire: matchToPlay.adversaire || '',\n          date: matchToPlay.date || '',\n          statut: 'joue',\n          score_equipe: scoreEquipe,\n          score_adversaire: scoreAdversaire,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        };\n        if (matchToPlay.lieu) {\n          matchData.lieu = matchToPlay.lieu;\n        }\n        await setDoc(matchRef, matchData);\n      }\n      const updatedMatchs = matchs.map(m => m.id === matchToPlay.id ? {\n        ...m,\n        statut: 'joue',\n        score_equipe: scoreEquipe,\n        score_adversaire: scoreAdversaire\n      } : m);\n      setMatchs(updatedMatchs);\n      showNotification('✅ Match marqué comme joué', 'success');\n      setShowScoreModal(false);\n      setMatchToPlay(null);\n      setScoreEquipeInput('');\n      setScoreAdversaireInput('');\n    } catch (error) {\n      console.error('Erreur confirmerScoreEtJouer:', error);\n      showNotification('❌ Erreur lors de la mise à jour du match', 'error');\n    }\n  };\n  const demanderRepasserEnAttente = matchId => {\n    setMatchToReset(matchId);\n    setShowConfirmModal(true);\n  };\n  const confirmerRepasserEnAttente = async (matchs, setMatchs, notes, setNotes, setButeurs, setTempsDeJeu, setPassesD) => {\n    if (!matchToReset) return;\n    try {\n      const matchRef = doc(db, 'matchs', String(matchToReset));\n      const matchDoc = await getDoc(matchRef);\n      if (matchDoc.exists()) {\n        await updateDoc(matchRef, {\n          statut: 'avenir',\n          score_equipe: null,\n          score_adversaire: null,\n          updatedAt: new Date()\n        });\n      }\n\n      // Supprimer notes localement et dans Firestore\n      const notesToDelete = notes.filter(n => n.id_match === matchToReset);\n      for (const note of notesToDelete) {\n        const noteRef = doc(db, 'notes', `${matchToReset}_${note.id_joueur}`);\n        const noteDoc = await getDoc(noteRef);\n        if (noteDoc.exists()) {\n          await deleteDoc(noteRef);\n        }\n      }\n      setNotes(notes.filter(n => n.id_match !== matchToReset));\n\n      // Supprimer stats localement\n      setButeurs(prev => prev.filter(b => b.id_match !== matchToReset));\n      setTempsDeJeu(prev => prev.filter(t => t.id_match !== matchToReset));\n      setPassesD(prev => prev.filter(p => p.id_match !== matchToReset));\n      const updatedMatchs = matchs.map(m => m.id === matchToReset ? {\n        ...m,\n        statut: 'avenir',\n        score_equipe: null,\n        score_adversaire: null\n      } : m);\n      setMatchs(updatedMatchs);\n      setShowConfirmModal(false);\n      setMatchToReset(null);\n    } catch (error) {\n      console.error('Erreur repasserEnAttente:', error);\n    }\n  };\n  const annulerRepasserEnAttente = () => {\n    setShowConfirmModal(false);\n    setMatchToReset(null);\n  };\n  return {\n    selectedMatch,\n    setSelectedMatch,\n    showScoreModal,\n    setShowScoreModal,\n    matchToPlay,\n    scoreEquipeInput,\n    setScoreEquipeInput,\n    scoreAdversaireInput,\n    setScoreAdversaireInput,\n    showConfirmModal,\n    marquerCommeJoue,\n    confirmerScoreEtJouer,\n    demanderRepasserEnAttente,\n    confirmerRepasserEnAttente,\n    annulerRepasserEnAttente\n  };\n};\n_s(useMatchManagement, \"g/6uT0J+cecPCB4YbLJaCtdNPw4=\");\nexport default useMatchManagement;","map":{"version":3,"names":["useState","doc","updateDoc","deleteDoc","setDoc","getDoc","db","useMatchManagement","_s","selectedMatch","setSelectedMatch","showScoreModal","setShowScoreModal","matchToPlay","setMatchToPlay","scoreEquipeInput","setScoreEquipeInput","scoreAdversaireInput","setScoreAdversaireInput","showConfirmModal","setShowConfirmModal","matchToReset","setMatchToReset","marquerCommeJoue","matchId","matchs","match","find","m","id","confirmerScoreEtJouer","setMatchs","showNotification","scoreEquipe","parseInt","scoreAdversaire","matchRef","String","matchDoc","exists","statut","score_equipe","score_adversaire","updatedAt","Date","matchData","adversaire","date","createdAt","lieu","updatedMatchs","map","error","console","demanderRepasserEnAttente","confirmerRepasserEnAttente","notes","setNotes","setButeurs","setTempsDeJeu","setPassesD","notesToDelete","filter","n","id_match","note","noteRef","id_joueur","noteDoc","prev","b","t","p","annulerRepasserEnAttente"],"sources":["/Users/hichamghazi/Desktop/esc-cappelle/src/hooks/useMatchManagement.js"],"sourcesContent":["import { useState } from 'react';\nimport { doc, updateDoc, deleteDoc, setDoc, getDoc } from 'firebase/firestore';\nimport { db } from '../config/firebase';\n\nconst useMatchManagement = () => {\n  const [selectedMatch, setSelectedMatch] = useState(null);\n  const [showScoreModal, setShowScoreModal] = useState(false);\n  const [matchToPlay, setMatchToPlay] = useState(null);\n  const [scoreEquipeInput, setScoreEquipeInput] = useState('');\n  const [scoreAdversaireInput, setScoreAdversaireInput] = useState('');\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\n  const [matchToReset, setMatchToReset] = useState(null);\n\n  const marquerCommeJoue = async (matchId, matchs) => {\n    const match = matchs.find(m => m.id === matchId);\n    if (!match) return;\n\n    setMatchToPlay(match);\n    setShowScoreModal(true);\n  };\n\n  const confirmerScoreEtJouer = async (matchs, setMatchs, showNotification) => {\n    if (!matchToPlay) return;\n\n    const scoreEquipe = parseInt(scoreEquipeInput) || 0;\n    const scoreAdversaire = parseInt(scoreAdversaireInput) || 0;\n\n    try {\n      const matchRef = doc(db, 'matchs', String(matchToPlay.id));\n      const matchDoc = await getDoc(matchRef);\n\n      if (matchDoc.exists()) {\n        await updateDoc(matchRef, {\n          statut: 'joue',\n          score_equipe: scoreEquipe,\n          score_adversaire: scoreAdversaire,\n          updatedAt: new Date()\n        });\n      } else {\n        const matchData = {\n          id: String(matchToPlay.id),\n          adversaire: matchToPlay.adversaire || '',\n          date: matchToPlay.date || '',\n          statut: 'joue',\n          score_equipe: scoreEquipe,\n          score_adversaire: scoreAdversaire,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        };\n        \n        if (matchToPlay.lieu) {\n          matchData.lieu = matchToPlay.lieu;\n        }\n        \n        await setDoc(matchRef, matchData);\n      }\n\n      const updatedMatchs = matchs.map(m =>\n        m.id === matchToPlay.id\n          ? { ...m, statut: 'joue', score_equipe: scoreEquipe, score_adversaire: scoreAdversaire }\n          : m\n      );\n      setMatchs(updatedMatchs);\n\n      showNotification('✅ Match marqué comme joué', 'success');\n      setShowScoreModal(false);\n      setMatchToPlay(null);\n      setScoreEquipeInput('');\n      setScoreAdversaireInput('');\n    } catch (error) {\n      console.error('Erreur confirmerScoreEtJouer:', error);\n      showNotification('❌ Erreur lors de la mise à jour du match', 'error');\n    }\n  };\n\n  const demanderRepasserEnAttente = (matchId) => {\n    setMatchToReset(matchId);\n    setShowConfirmModal(true);\n  };\n\n  const confirmerRepasserEnAttente = async (matchs, setMatchs, notes, setNotes, setButeurs, setTempsDeJeu, setPassesD) => {\n    if (!matchToReset) return;\n\n    try {\n      const matchRef = doc(db, 'matchs', String(matchToReset));\n      const matchDoc = await getDoc(matchRef);\n\n      if (matchDoc.exists()) {\n        await updateDoc(matchRef, {\n          statut: 'avenir',\n          score_equipe: null,\n          score_adversaire: null,\n          updatedAt: new Date()\n        });\n      }\n\n      // Supprimer notes localement et dans Firestore\n      const notesToDelete = notes.filter(n => n.id_match === matchToReset);\n      for (const note of notesToDelete) {\n        const noteRef = doc(db, 'notes', `${matchToReset}_${note.id_joueur}`);\n        const noteDoc = await getDoc(noteRef);\n        if (noteDoc.exists()) {\n          await deleteDoc(noteRef);\n        }\n      }\n      setNotes(notes.filter(n => n.id_match !== matchToReset));\n\n      // Supprimer stats localement\n      setButeurs(prev => prev.filter(b => b.id_match !== matchToReset));\n      setTempsDeJeu(prev => prev.filter(t => t.id_match !== matchToReset));\n      setPassesD(prev => prev.filter(p => p.id_match !== matchToReset));\n\n      const updatedMatchs = matchs.map(m =>\n        m.id === matchToReset\n          ? { ...m, statut: 'avenir', score_equipe: null, score_adversaire: null }\n          : m\n      );\n      setMatchs(updatedMatchs);\n\n      setShowConfirmModal(false);\n      setMatchToReset(null);\n    } catch (error) {\n      console.error('Erreur repasserEnAttente:', error);\n    }\n  };\n\n  const annulerRepasserEnAttente = () => {\n    setShowConfirmModal(false);\n    setMatchToReset(null);\n  };\n\n  return {\n    selectedMatch,\n    setSelectedMatch,\n    showScoreModal,\n    setShowScoreModal,\n    matchToPlay,\n    scoreEquipeInput,\n    setScoreEquipeInput,\n    scoreAdversaireInput,\n    setScoreAdversaireInput,\n    showConfirmModal,\n    marquerCommeJoue,\n    confirmerScoreEtJouer,\n    demanderRepasserEnAttente,\n    confirmerRepasserEnAttente,\n    annulerRepasserEnAttente\n  };\n};\n\nexport default useMatchManagement;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}