{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut as firebaseSignOut, onAuthStateChanged } from 'firebase/auth';\nimport { doc, getDoc, setDoc, collection, query, where, getDocs } from 'firebase/firestore';\nimport { auth, db } from '../config/firebase';\nexport const useFirebaseAuth = () => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // √âcouter les changements d'auth\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async firebaseUser => {\n      if (firebaseUser) {\n        // R√©cup√©rer les donn√©es utilisateur depuis Firestore\n        const userDoc = await getDoc(doc(db, 'users', firebaseUser.uid));\n        if (userDoc.exists()) {\n          setUser({\n            uid: firebaseUser.uid,\n            ...userDoc.data()\n          });\n        }\n      } else {\n        setUser(null);\n      }\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, []);\n  const handleLogin = async (username, password) => {\n    try {\n      console.log('üîê Tentative login pour:', username);\n\n      // Cr√©er email Firebase √† partir du username\n      const email = `${username.toLowerCase()}@esccappelle.com`;\n      try {\n        // Essayer de se connecter √† Firebase Auth\n        console.log('üî• Connexion Firebase Auth...');\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\n        console.log('‚úÖ Connect√© √† Firebase:', userCredential.user.uid);\n\n        // V√©rifier que le document Firestore existe\n        const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));\n        if (userDoc.exists()) {\n          console.log('‚úÖ Utilisateur Firestore trouv√©:', userDoc.data().nom);\n          return {\n            success: true\n          };\n        } else {\n          console.error('‚ùå Document Firestore manquant pour cet utilisateur');\n          return {\n            success: false,\n            error: 'Compte incomplet, contactez l\\'administrateur'\n          };\n        }\n      } catch (loginError) {\n        console.error('‚ùå Erreur connexion Firebase:', loginError.code);\n\n        // Si les identifiants sont invalides, afficher un message clair\n        if (loginError.code === 'auth/user-not-found' || loginError.code === 'auth/invalid-credential' || loginError.code === 'auth/wrong-password') {\n          return {\n            success: false,\n            error: 'Identifiants incorrects. Si vous n\\'avez pas encore de compte, contactez le coach.'\n          };\n        }\n        return {\n          success: false,\n          error: 'Erreur de connexion: ' + loginError.message\n        };\n      }\n    } catch (error) {\n      console.error('‚ùå Erreur login:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  };\n\n  // Fonction pour cr√©er un nouvel utilisateur (r√©serv√©e aux coachs via interface d'admin)\n  const handleRegister = async userData => {\n    try {\n      const {\n        username,\n        password,\n        nom,\n        role,\n        id\n      } = userData;\n      const email = `${username.toLowerCase()}@esccappelle.com`;\n      console.log('üÜï Cr√©ation compte Firebase pour:', username);\n\n      // Cr√©er le compte Firebase Auth\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      console.log('‚úÖ Compte Firebase cr√©√©:', userCredential.user.uid);\n\n      // Cr√©er le document Firestore\n      await setDoc(doc(db, 'users', userCredential.user.uid), {\n        id: id,\n        nom: nom,\n        username: username,\n        role: role,\n        email: email,\n        createdAt: new Date().toISOString()\n      });\n      console.log('‚úÖ Document Firestore cr√©√©');\n      return {\n        success: true\n      };\n    } catch (error) {\n      console.error('‚ùå Erreur cr√©ation compte:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  };\n  const handleLogout = async () => {\n    try {\n      await firebaseSignOut(auth);\n      setUser(null);\n    } catch (error) {\n      console.error('‚ùå Erreur logout:', error);\n    }\n  };\n  return {\n    user,\n    loading,\n    handleLogin,\n    handleRegister,\n    handleLogout\n  };\n};\n_s(useFirebaseAuth, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");","map":{"version":3,"names":["useState","useEffect","signInWithEmailAndPassword","createUserWithEmailAndPassword","signOut","firebaseSignOut","onAuthStateChanged","doc","getDoc","setDoc","collection","query","where","getDocs","auth","db","useFirebaseAuth","_s","user","setUser","loading","setLoading","unsubscribe","firebaseUser","userDoc","uid","exists","data","handleLogin","username","password","console","log","email","toLowerCase","userCredential","nom","success","error","loginError","code","message","handleRegister","userData","role","id","createdAt","Date","toISOString","handleLogout"],"sources":["/Users/hichamghazi/Desktop/esc-cappelle/src/hooks/useFirebaseAuth.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport {\n  signInWithEmailAndPassword,\n  createUserWithEmailAndPassword,\n  signOut as firebaseSignOut,\n  onAuthStateChanged\n} from 'firebase/auth';\nimport { doc, getDoc, setDoc, collection, query, where, getDocs } from 'firebase/firestore';\nimport { auth, db } from '../config/firebase';\n\nexport const useFirebaseAuth = () => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // √âcouter les changements d'auth\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {\n      if (firebaseUser) {\n        // R√©cup√©rer les donn√©es utilisateur depuis Firestore\n        const userDoc = await getDoc(doc(db, 'users', firebaseUser.uid));\n        if (userDoc.exists()) {\n          setUser({ uid: firebaseUser.uid, ...userDoc.data() });\n        }\n      } else {\n        setUser(null);\n      }\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const handleLogin = async (username, password) => {\n    try {\n      console.log('üîê Tentative login pour:', username);\n\n      // Cr√©er email Firebase √† partir du username\n      const email = `${username.toLowerCase()}@esccappelle.com`;\n\n      try {\n        // Essayer de se connecter √† Firebase Auth\n        console.log('üî• Connexion Firebase Auth...');\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\n        console.log('‚úÖ Connect√© √† Firebase:', userCredential.user.uid);\n\n        // V√©rifier que le document Firestore existe\n        const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));\n        if (userDoc.exists()) {\n          console.log('‚úÖ Utilisateur Firestore trouv√©:', userDoc.data().nom);\n          return { success: true };\n        } else {\n          console.error('‚ùå Document Firestore manquant pour cet utilisateur');\n          return { success: false, error: 'Compte incomplet, contactez l\\'administrateur' };\n        }\n\n      } catch (loginError) {\n        console.error('‚ùå Erreur connexion Firebase:', loginError.code);\n\n        // Si les identifiants sont invalides, afficher un message clair\n        if (loginError.code === 'auth/user-not-found' ||\n            loginError.code === 'auth/invalid-credential' ||\n            loginError.code === 'auth/wrong-password') {\n          return {\n            success: false,\n            error: 'Identifiants incorrects. Si vous n\\'avez pas encore de compte, contactez le coach.'\n          };\n        }\n\n        return { success: false, error: 'Erreur de connexion: ' + loginError.message };\n      }\n    } catch (error) {\n      console.error('‚ùå Erreur login:', error);\n      return { success: false, error: error.message };\n    }\n  };\n\n  // Fonction pour cr√©er un nouvel utilisateur (r√©serv√©e aux coachs via interface d'admin)\n  const handleRegister = async (userData) => {\n    try {\n      const { username, password, nom, role, id } = userData;\n      const email = `${username.toLowerCase()}@esccappelle.com`;\n\n      console.log('üÜï Cr√©ation compte Firebase pour:', username);\n\n      // Cr√©er le compte Firebase Auth\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      console.log('‚úÖ Compte Firebase cr√©√©:', userCredential.user.uid);\n\n      // Cr√©er le document Firestore\n      await setDoc(doc(db, 'users', userCredential.user.uid), {\n        id: id,\n        nom: nom,\n        username: username,\n        role: role,\n        email: email,\n        createdAt: new Date().toISOString()\n      });\n      console.log('‚úÖ Document Firestore cr√©√©');\n\n      return { success: true };\n    } catch (error) {\n      console.error('‚ùå Erreur cr√©ation compte:', error);\n      return { success: false, error: error.message };\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await firebaseSignOut(auth);\n      setUser(null);\n    } catch (error) {\n      console.error('‚ùå Erreur logout:', error);\n    }\n  };\n\n  return {\n    user,\n    loading,\n    handleLogin,\n    handleRegister,\n    handleLogout\n  };\n};"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SACEC,0BAA0B,EAC1BC,8BAA8B,EAC9BC,OAAO,IAAIC,eAAe,EAC1BC,kBAAkB,QACb,eAAe;AACtB,SAASC,GAAG,EAAEC,MAAM,EAAEC,MAAM,EAAEC,UAAU,EAAEC,KAAK,EAAEC,KAAK,EAAEC,OAAO,QAAQ,oBAAoB;AAC3F,SAASC,IAAI,EAAEC,EAAE,QAAQ,oBAAoB;AAE7C,OAAO,MAAMC,eAAe,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnC,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGnB,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAACoB,OAAO,EAAEC,UAAU,CAAC,GAAGrB,QAAQ,CAAC,IAAI,CAAC;;EAE5C;EACAC,SAAS,CAAC,MAAM;IACd,MAAMqB,WAAW,GAAGhB,kBAAkB,CAACQ,IAAI,EAAE,MAAOS,YAAY,IAAK;MACnE,IAAIA,YAAY,EAAE;QAChB;QACA,MAAMC,OAAO,GAAG,MAAMhB,MAAM,CAACD,GAAG,CAACQ,EAAE,EAAE,OAAO,EAAEQ,YAAY,CAACE,GAAG,CAAC,CAAC;QAChE,IAAID,OAAO,CAACE,MAAM,CAAC,CAAC,EAAE;UACpBP,OAAO,CAAC;YAAEM,GAAG,EAAEF,YAAY,CAACE,GAAG;YAAE,GAAGD,OAAO,CAACG,IAAI,CAAC;UAAE,CAAC,CAAC;QACvD;MACF,CAAC,MAAM;QACLR,OAAO,CAAC,IAAI,CAAC;MACf;MACAE,UAAU,CAAC,KAAK,CAAC;IACnB,CAAC,CAAC;IAEF,OAAO,MAAMC,WAAW,CAAC,CAAC;EAC5B,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMM,WAAW,GAAG,MAAAA,CAAOC,QAAQ,EAAEC,QAAQ,KAAK;IAChD,IAAI;MACFC,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEH,QAAQ,CAAC;;MAEjD;MACA,MAAMI,KAAK,GAAG,GAAGJ,QAAQ,CAACK,WAAW,CAAC,CAAC,kBAAkB;MAEzD,IAAI;QACF;QACAH,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;QAC5C,MAAMG,cAAc,GAAG,MAAMjC,0BAA0B,CAACY,IAAI,EAAEmB,KAAK,EAAEH,QAAQ,CAAC;QAC9EC,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEG,cAAc,CAACjB,IAAI,CAACO,GAAG,CAAC;;QAE9D;QACA,MAAMD,OAAO,GAAG,MAAMhB,MAAM,CAACD,GAAG,CAACQ,EAAE,EAAE,OAAO,EAAEoB,cAAc,CAACjB,IAAI,CAACO,GAAG,CAAC,CAAC;QACvE,IAAID,OAAO,CAACE,MAAM,CAAC,CAAC,EAAE;UACpBK,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAER,OAAO,CAACG,IAAI,CAAC,CAAC,CAACS,GAAG,CAAC;UAClE,OAAO;YAAEC,OAAO,EAAE;UAAK,CAAC;QAC1B,CAAC,MAAM;UACLN,OAAO,CAACO,KAAK,CAAC,oDAAoD,CAAC;UACnE,OAAO;YAAED,OAAO,EAAE,KAAK;YAAEC,KAAK,EAAE;UAAgD,CAAC;QACnF;MAEF,CAAC,CAAC,OAAOC,UAAU,EAAE;QACnBR,OAAO,CAACO,KAAK,CAAC,8BAA8B,EAAEC,UAAU,CAACC,IAAI,CAAC;;QAE9D;QACA,IAAID,UAAU,CAACC,IAAI,KAAK,qBAAqB,IACzCD,UAAU,CAACC,IAAI,KAAK,yBAAyB,IAC7CD,UAAU,CAACC,IAAI,KAAK,qBAAqB,EAAE;UAC7C,OAAO;YACLH,OAAO,EAAE,KAAK;YACdC,KAAK,EAAE;UACT,CAAC;QACH;QAEA,OAAO;UAAED,OAAO,EAAE,KAAK;UAAEC,KAAK,EAAE,uBAAuB,GAAGC,UAAU,CAACE;QAAQ,CAAC;MAChF;IACF,CAAC,CAAC,OAAOH,KAAK,EAAE;MACdP,OAAO,CAACO,KAAK,CAAC,iBAAiB,EAAEA,KAAK,CAAC;MACvC,OAAO;QAAED,OAAO,EAAE,KAAK;QAAEC,KAAK,EAAEA,KAAK,CAACG;MAAQ,CAAC;IACjD;EACF,CAAC;;EAED;EACA,MAAMC,cAAc,GAAG,MAAOC,QAAQ,IAAK;IACzC,IAAI;MACF,MAAM;QAAEd,QAAQ;QAAEC,QAAQ;QAAEM,GAAG;QAAEQ,IAAI;QAAEC;MAAG,CAAC,GAAGF,QAAQ;MACtD,MAAMV,KAAK,GAAG,GAAGJ,QAAQ,CAACK,WAAW,CAAC,CAAC,kBAAkB;MAEzDH,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEH,QAAQ,CAAC;;MAE1D;MACA,MAAMM,cAAc,GAAG,MAAMhC,8BAA8B,CAACW,IAAI,EAAEmB,KAAK,EAAEH,QAAQ,CAAC;MAClFC,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAEG,cAAc,CAACjB,IAAI,CAACO,GAAG,CAAC;;MAE/D;MACA,MAAMhB,MAAM,CAACF,GAAG,CAACQ,EAAE,EAAE,OAAO,EAAEoB,cAAc,CAACjB,IAAI,CAACO,GAAG,CAAC,EAAE;QACtDoB,EAAE,EAAEA,EAAE;QACNT,GAAG,EAAEA,GAAG;QACRP,QAAQ,EAAEA,QAAQ;QAClBe,IAAI,EAAEA,IAAI;QACVX,KAAK,EAAEA,KAAK;QACZa,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACpC,CAAC,CAAC;MACFjB,OAAO,CAACC,GAAG,CAAC,2BAA2B,CAAC;MAExC,OAAO;QAAEK,OAAO,EAAE;MAAK,CAAC;IAC1B,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdP,OAAO,CAACO,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,OAAO;QAAED,OAAO,EAAE,KAAK;QAAEC,KAAK,EAAEA,KAAK,CAACG;MAAQ,CAAC;IACjD;EACF,CAAC;EAED,MAAMQ,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI;MACF,MAAM5C,eAAe,CAACS,IAAI,CAAC;MAC3BK,OAAO,CAAC,IAAI,CAAC;IACf,CAAC,CAAC,OAAOmB,KAAK,EAAE;MACdP,OAAO,CAACO,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;IAC1C;EACF,CAAC;EAED,OAAO;IACLpB,IAAI;IACJE,OAAO;IACPQ,WAAW;IACXc,cAAc;IACdO;EACF,CAAC;AACH,CAAC;AAAChC,EAAA,CAhHWD,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}